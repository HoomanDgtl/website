---
import PostCard from "@/components/cards/post-card.astro";
import AiModelsAndApps from "@/components/home/aiModelsAndApps/aiModelsAndApps.astro";
import Hero from "@/components/home/hero/hero.astro";
import Infrastructure from "@/components/home/infrastructure/infrastructure.astro";
import Testimonials from "@/components/home/testimonials/testimonials.astro";
import TrustedBy from "@/components/home/trusted-by.astro";
import ButtonLink from "@/components/ui/button-link.astro";
import Layout from "@/layouts/layout.astro";
import { getCollection, getEntry, type CollectionEntry } from "astro:content";
import { ChevronRight } from "lucide-react";

const homepage = await getEntry("Homepage", "index");

type BlogPost = CollectionEntry<"Blog">;

const posts = (await getCollection("Blog"))
  .filter((post) => {
    return post.data.archive !== true;
  })
  .sort((a, b) => {
    const dateA = new Date(a.data.pubDate);
    const dateB = new Date(b.data.pubDate);
    return dateB.getTime() - dateA.getTime();
  });
const {
  advert,
  heroSection,
  infrastructureSection,
  featureSection,
  aiModelsAndAppsSection,
  testimonialsSection,
  trustedBySection,
} = homepage?.data;
---

<Layout
  title="Akash Network - Decentralized Compute Marketplace"
  description="Akash is an open network that lets users buy and sell computing resources securely and efficiently. Purpose-built for public utility."
>
  <div>
    <Hero heroSection={heroSection} />
    <TrustedBy trustedBySection={trustedBySection} />

    <Infrastructure infrastructureSection={infrastructureSection} />
    <section class="bg-primary">
      <div
        class="flex flex-col items-center justify-center bg-[url('/images/trustedby/gradient-primary.svg')] bg-cover bg-center py-20"
      >
        <img src="/images/akashstar.svg" alt="Akash Star" class="h-12" />
        <div class="mt-5 flex flex-col gap-2">
          <h2 class="text-center text-5xl font-semibold">
            <span class="font-instrument">AKT</span>:The Fuel Behind Akash
          </h2>
          <p class="text-[#9E1E26]">
            AKT is the utility token that powers every GPU transaction on the
            Akash decentralized cloud.
          </p>
        </div>
        <a class="mt-10 flex items-center gap-2">
          Learn How AKT Works <ChevronRight className="h-4 w-4" />
        </a>
      </div>
    </section>
    <AiModelsAndApps aiModelsAndAppsSection={aiModelsAndAppsSection} />
    <Testimonials testimonialsSection={testimonialsSection} />
    <div class="container mb-[120px] mt-[120px]">
      <div class="border-b border-paraDark"></div>
    </div>
    <div class="container">
      <div class="flex items-center justify-between">
        <h2 class="text-xl font-medium md:text-2xl lg:text-2lg">
          Discover what's happening on Akash
        </h2>
        <ButtonLink link="/blog" variant="secondary">View All Posts</ButtonLink>
      </div>
      <div
        class="mt-10 grid grid-cols-1 gap-16 sm:grid-cols-2 md:gap-16 lg:grid-cols-3"
      >
        {
          posts.slice(0, 3).map((post: BlogPost) => {
            return (
              <a href={`/blog/${post.slug}`} class=" flex cursor-pointer">
                <PostCard
                  title={post.data.title}
                  image={post.data.bannerImage as any}
                  tag={post.data.tags[0]}
                  contributor={post.data.contributors[0]}
                  pubDate={post.data.pubDate}
                  description={post.data.description}
                />
              </a>
            );
          })
        }
      </div>
    </div>
  </div>
</Layout>
